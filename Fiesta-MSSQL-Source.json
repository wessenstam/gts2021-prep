{"status":{},"contains_secrets":false,"product_version":"3.1.1","spec":{"description":"* [Fiesta Application](http:\/\/@@{NodeReact.address}@@\/)","resources":{"client_attrs":{"None":{"y":315,"x":772.75},"0044927b_deployment":{"y":236.3630153085,"x":-117.3091805206},"32bb16c2_deployment":{"y":238.240814209,"x":-318.5397205353},"1f371151-845e-4426-afa2-5e970b29f118":{"y":294.8663607217,"x":327.5990821651}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"21c5a65f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"52bdec78_runbook","main_task_local_reference":{"kind":"app_task","name":"21c5a65f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7feaa10e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"75b1a5f3_runbook","main_task_local_reference":{"kind":"app_task","name":"7feaa10e_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e042bc0d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ee27da6_runbook","main_task_local_reference":{"kind":"app_task","name":"e042bc0d_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a30ac1c7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"57819f94_runbook","main_task_local_reference":{"kind":"app_task","name":"a30ac1c7_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"89549cc9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"610f4641_runbook","main_task_local_reference":{"kind":"app_task","name":"89549cc9_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"Database"}],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Database"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7c8077af_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a6def0dc_runbook","main_task_local_reference":{"kind":"app_task","name":"7c8077af_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Database"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e1fbf405_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bceab72b_runbook","main_task_local_reference":{"kind":"app_task","name":"e1fbf405_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Database"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d96d5bb9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"07e2eceb_runbook","main_task_local_reference":{"kind":"app_task","name":"d96d5bb9_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Database"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7083d8d8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"788814a1_runbook","main_task_local_reference":{"kind":"app_task","name":"7083d8d8_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Database"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bfba34e3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"dfa52791_runbook","main_task_local_reference":{"kind":"app_task","name":"bfba34e3_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Database","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"CentOS_Node","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"@@{user_initials}@@-FiestaWeb","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"d1815121-9030-4833-82af-98def3b8d8d2"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\nchpasswd:\n  list: |\n    root:nutanix\/4u\n    centos:nutanix\/4u\n  expire: False\nssh_pwauth:   true\nruncmd:\n  - yum -y install lvm2\n  - [eject]"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"1da60144-6b20-4ea1-be60-cf752446d181","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_7_Cloud","uuid":"7c7d0314-eaaf-4dc4-b654-9993c7db4a12"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"MSSQL","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","connection_protocol":"http","connection_port":5985,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":true},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Windows","create_spec":{"name":"@@{user_initials}@@-MSSQL-Source","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"d1815121-9030-4833-82af-98def3b8d8d2"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"1da60144-6b20-4ea1-be60-cf752446d181","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"MSSQL16-Source-Disk1.qcow2","uuid":"52f23b4d-a5af-4433-a47c-38cdcaf8e4d6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":{"kind":"image","type":"","name":"MSSQL16-Source-Disk2.qcow2","uuid":"b186b99b-2de7-4cbc-b22c-6fc4d8ec87c5"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS"}],"package_definition_list":[{"description":"CentOS 7 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_7_Cloud","version":"","options":{"type":"","name":"CentOS_7_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"Package3","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"1InstallSoftware"},{"kind":"app_task","name":"2ConfApp"}],"name":"47b39829_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"1InstallSoftware"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2ConfApp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1InstallSoftware","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Update and install packages\n#sudo yum -y update\nsudo yum -y install wget git vim gcc gcc-c++ #nginx\n\n# Install node\ncurl -sL https:\/\/rpm.nodesource.com\/setup_10.x | sudo bash -\nsudo yum install -y nodejs\nnode --version\n\n# Clone Repo\ngit clone https:\/\/github.com\/sharonpamela\/Fiesta.git\ncd ~\/Fiesta\nnpm install\ncd ~\/Fiesta\/client\nnpm install\nnpm run build\nnpm install nodemon concurrently\n\nsudo setenforce Permissive\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2ConfApp","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Modify DB config file\n\nsudo sed -i 's\/REPLACE_DB_NAME\/@@{db_name}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_HOST_ADDRESS\/@@{Database.address}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_DIALECT\/@@{db_dialect}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_DOMAIN_NAME\/@@{db_domain_name}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_USER_NAME\/@@{db_username}@@\/g' ~\/Fiesta\/config\/config.js\ndb_password='@@{db_password}@@'\ndb_escaped_pass=\"${db_password\/\/\\\/\/\\\\\/}\"\nsudo sed -i \"s\/REPLACE_DB_PASSWORD\/`echo $db_escaped_pass`\/g\" ~\/Fiesta\/config\/config.js\n\n# Create the unit file\necho '[Service]\n\nExecStart=\/usr\/bin\/node \/home\/centos\/Fiesta\/index.js\nRestart=always\nRestartSec=2s\n\nStandardOutput=syslog\nStandardError=syslog\n\nSyslogIdentifier=fiesta\n\nUser=root\nGroup=root\n\nEnvironment=NODE_ENV=production PORT=80\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/fiesta.service\n\n# Reload daemons and start service\nsudo systemctl daemon-reload\nsudo systemctl start fiesta\nsudo systemctl enable fiesta\nsudo systemctl status fiesta -l\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"29790a71_runbook","main_task_local_reference":{"kind":"app_task","name":"47b39829_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e1cdd743_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"17adb48b_runbook","main_task_local_reference":{"kind":"app_task","name":"e1cdd743_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Database"}],"name":"MSSQLPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MSSQLPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ad57e430_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c222f5e8_runbook","main_task_local_reference":{"kind":"app_task","name":"ad57e430_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MSSQLPackage"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0c1c6fbe_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"02614850_runbook","main_task_local_reference":{"kind":"app_task","name":"0c1c6fbe_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"0044927b_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package3"}],"substrate_local_reference":{"kind":"app_substrate","name":"CentOS_Node"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"32bb16c2_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MSSQLPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"MSSQL"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"Run this action to update your DB configuration (IP, credentials) and restart the Fiesta application.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"UpdateConfig"}],"name":"5519bf8f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"UpdateConfig","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Modify DB config file\n\nsudo sed -i \"s\/DB_NAME:.*\/DB_NAME: '@@{new_db_name}@@',\/\" ~\/Fiesta\/config\/config.js\nsudo sed -i \"s\/DB_HOST_ADDRESS:.*\/DB_HOST_ADDRESS: '@@{new_db_ip}@@',\/\" ~\/Fiesta\/config\/config.js\nsudo sed -i \"s\/DB_DOMAIN_NAME:.*\/DB_DOMAIN_NAME: '@@{new_db_domain}@@',\/\" ~\/Fiesta\/config\/config.js\nsudo sed -i \"s\/DB_USER_NAME:.*\/DB_USER_NAME: '@@{new_db_username}@@',\/\" ~\/Fiesta\/config\/config.js\ndb_password='@@{new_db_password}@@'\ndb_escaped_pass=\"${db_password\/\/\\\/\/\\\\\/}\"\nsudo sed -i \"s\/DB_PASSWORD:.*\/DB_PASSWORD: '$db_escaped_pass'\/\" ~\/Fiesta\/config\/config.js\n\n# Reload daemons and start service\nsudo systemctl restart fiesta\nsudo systemctl status fiesta -l\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"7b46a1ca_runbook","main_task_local_reference":{"kind":"app_task","name":"5519bf8f_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"new_db_password","value":"","label":"Password","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"Leave blank for non-domain-joined DB Server VMs ","data_type":"BASE","type":"LOCAL","name":"new_db_domain","value":"NTNXLAB","label":"Domain","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"new_db_username","value":"","label":"User Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"Use the virtual IP for HA DB deployments","data_type":"BASE","type":"LOCAL","name":"new_db_ip","value":"","label":"New DB Server IP Address","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"Note the name of the cloned Era database","data_type":"BASE","type":"LOCAL","name":"new_db_name","value":"","label":"New DB Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"name":"Update DB Config"}],"name":"AHV","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"db_dialect","value":"mssql","label":"","attrs":{"type":""},"editables":{"value":false},"is_hidden":true,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"FQDN required for domain joined MSSQL databases (e.g. NTNXLAB.local)","data_type":"BASE","type":"LOCAL","name":"db_domain_name","value":"","label":"Domain Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"db_password","value":"","label":"Password","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"db_username","value":"Administrator","label":"User Name","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"db_name","value":"Fiesta","label":"Database Name","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"Lab assigned user label for uniquely identifying your assets on a shared cluster (e.g. U1 for User01). Alternatively, you can use your initials.","data_type":"BASE","type":"LOCAL","name":"user_initials","value":"","label":"U#","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"Fiesta-MSSQL-Source"},"api_version":"3.0","metadata":{"last_update_time":"1611698808180359","kind":"blueprint","spec_version":22,"creation_time":"1610561723695043","name":"Fiesta-MSSQL-Source"}}